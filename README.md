# Kamara SSE scheme

## Постановка задачи
Реализовать криптографическую защиту данных пользовательских файлов при передаче и хранении на удалённом сервере. Обеспечить возможность поиска по ключевому слову.

## Описание
Для выполнения поставленной задачи разработано два консольных приложения (client и server), в котором реализованы функции сбора имён файлов по директории (для записи в базу данных всей папки сразу), выделение имени файла 
(в целях использования их как уникальных id(f)), функция генерации ключа на основе стандарта PBKDF2, шифрование и дешифрование файлов с использованием алгоритма AES-256 в режиме CBC (Cipher Block Chaining), 
для проверки целостности используется HMAC - код проверки подлинности сообщений, использующий односторонние хеш-функции (в качестве хеш-функции используется SHA-256). В данной версии системы также реализованы обращения сервера к базе данных
(идея имела целью наглядную демонстрацию). Для согласования пользовательских типов данных между клиентом и сервером используется общая директория common, содержащая данные конфигурации для подключения к базе данных,
структуры токенов, методы для сериализации и кодировки передаваемых данных.

## Инструментарий
- Для шифрования и дешифрования применяется алгоритм AES-256 в режиме CBC из библиотек OpenSSL
- Функция генерации ключа основана на стандарте PBKDF2
- Для единой точки доступа к классу 'Encryptor' используется паттерн **Singleton**

## Требования
- Дистрибутив Linux
- CMake v3.5 или выше
- Компилятор с поддержкой C++17
- OpenSSL (dev-пакет)
- Boost library
- Библиотек pqxx и pq (PostgreSQL)

## Установка зависимостей
```bash
sudo apt update
sudo apt install -y build-essential cmake libssl-dev
sudo apt install libboost-all-dev
sudo apt install pq pqxx
```

## Сборка
   Откройте командную строку и перейдите в директорию с исходным кодом клиента
   ```bash
    mkdir build
    cd build
    cmake ..
    make
   ```
  Аналогичные действия примените для директории сервера
## Использование
   ```bash
   # Запуск сервера в одном терминале (предполагается, что PostgreSQL уже поднят в docker)
   ./server
   # Запуск клиента
   ./client <key>
   ```
## Примеры
   ```bash
   # Добавить в базу данных подготовленный файл file_1.txt
   ./client some_pwd
   add ../../../output_directory/file_1.txt
   # Получить список id файлов с искомым словом (в нижнем регистре)
   search geonosis
   ```
## Структура проекта

```
.
├── client
│   ├── CMakeLists.txt
│   ├── cipher.cpp
│   ├── cipher.h
│   ├── client.cpp
│   ├── encryption.cpp
│   ├── encryption.h
│   ├── token_gen.cpp
│   ├── token_gen.h
│   ├── unique_words.cpp
│   └── unique_words.h
├── common
│   ├── base64.cpp
│   ├── base64.h
│   ├── config.h
│   └── sse_types.h
└── server
    ├── CMakeLists.txt
    ├── db_connector.cpp
    ├── db_connector.h
    ├── main.cpp
    ├── server.cpp
    └── server.h
```
